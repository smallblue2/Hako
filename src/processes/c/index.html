<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebAssembly with Emscripten Glue</title>
</head>

<body>
  <script type="module">
    import Pipe from './pipe.js';

    async function runWasm() {
      window.stdin = new Pipe(1024);
      window.stdout = new Pipe(1024);

      console.log("Creating worker");
      let worker = new Worker(new URL("worker.js", import.meta.url));
      console.log("Worker created");

      worker.onmessage = (e) => {
        console.log(e.data);
      }

      worker.postMessage({stdinBuffer: window.stdin.getBuffer(), stdoutBuffer: window.stdout.getBuffer()});
    }

    window.runWasm = runWasm;
  </script>

  <h1>WebAssembly Running via Emscripten</h1>
  <button onclick="runWasm()">Run WebAssembly</button>

</body>

</html>